# file: test_gemini.py
import streamlit as st
import google.generativeai as genai

st.title("Kiá»ƒm tra káº¿t ná»‘i Gemini AI")

# Láº¥y API key tá»« Streamlit Secrets
api_key = st.secrets.get("GOOGLE_API_KEY")

if not api_key:
    st.error("Lá»–I: KhÃ´ng tÃ¬m tháº¥y `GOOGLE_API_KEY` trong file secrets.toml.")
    st.info("Vui lÃ²ng kiá»ƒm tra láº¡i vá»‹ trÃ­ vÃ  ná»™i dung file .streamlit/secrets.toml")
else:
    st.success("âœ… ÄÃ£ tÃ¬m tháº¥y API Key trong secrets!")
    try:
        genai.configure(api_key=api_key)
        st.success("âœ… Cáº¥u hÃ¬nh API Key thÃ nh cÃ´ng!")

        model_names = [
            "gemini-1.5-flash-latest",
            "gemini-1.0-pro",
            "gemini-pro"
        ]
        
        st.info(f"Äang thá»­ káº¿t ná»‘i Ä‘áº¿n cÃ¡c model: {model_names}...")
        
        model_found = False
        for model_name in model_names:
            with st.spinner(f"Äang thá»­ model: {model_name}..."):
                try:
                    model = genai.GenerativeModel(model_name)
                    # Gá»­i má»™t yÃªu cáº§u nhá» Ä‘á»ƒ kiá»ƒm tra
                    response = model.generate_content("ChÃ o báº¡n", generation_config={"max_output_tokens": 5})
                    
                    st.success(f"âœ…âœ…âœ… Káº¾T Ná»I THÃ€NH CÃ”NG Vá»šI MODEL: {model_name}!")
                    st.write("Pháº£n há»“i tá»« AI:", response.text)
                    model_found = True
                    break # Dá»«ng láº¡i ngay khi tÃ¬m tháº¥y model hoáº¡t Ä‘á»™ng
                except Exception as e:
                    st.warning(f"âš ï¸ KhÃ´ng thá»ƒ káº¿t ná»‘i vá»›i model `{model_name}`. Lá»—i: {e}")
        
        if not model_found:
            st.error("ğŸš¨ Lá»–I CUá»I CÃ™NG: ÄÃ£ thá»­ táº¥t cáº£ cÃ¡c model nhÆ°ng khÃ´ng thá»ƒ káº¿t ná»‘i vá»›i báº¥t ká»³ model Gemini nÃ o.")
            st.warning("Vui lÃ²ng kiá»ƒm tra láº¡i API Key, cÃ¡c quyá»n cá»§a key, vÃ  káº¿t ná»‘i máº¡ng.")

    except Exception as e:
        st.error(f"ğŸš¨ Lá»–I NGHIÃŠM TRá»ŒNG: Lá»—i khi cáº¥u hÃ¬nh genai. Lá»—i nÃ y cho tháº¥y API Key cá»§a báº¡n cÃ³ thá»ƒ khÃ´ng há»£p lá»‡.")
        st.exception(e)
